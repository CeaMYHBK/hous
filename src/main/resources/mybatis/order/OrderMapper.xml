<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ceamback.project.order.mapper.OrderMapper">

    <resultMap id="OrderResult" type="Order">
        <id property="id" column="id" />
        <result property="orderSn" column="order_sn" />
        <result property="userId" column="user_id" />
        <result property="status" column="status" />
        <result property="shippingStatus" column="shipping_status" />
        <result property="payStatus" column="pay_status" />
        <result property="shippingId" column="shipping_id" />
        <result property="shippingName" column="ship_name" />
        <result property="shippingNo" column="shipping_no" />
        <result property="actualPrice" column="actual_price" />
        <result property="total" column="total" />
        <result property="actualTotal" column="actual_total" />
        <result property="typeId" column="type_id" />
        <result property="typeName" column="type_name" />
        <result property="userName" column="user_name" />
        <result property="createTime" column="create_time" />
    </resultMap>

    <select id="selectList" resultMap="OrderResult" parameterType="Order">
        SELECT
        a.*,
        b.user_name,
        c.type_name,
        d.ship_name
        FROM order_order a
        LEFT JOIN sys_user b ON a.user_id = b.user_id
        LEFT JOIN goods_type c ON a.type_id = c.type_id
        LEFT JOIN order_shipping d ON a.shipping_id = d.id
        <where>
            <if test="userName != null and userName != ''">
                b.user_name = #{userName}
            </if>
            <if test="status != null">
                and a.status = #{status}
            </if>
            <if test="typeId != null">
                and a.type_id = #{typeId}
            </if>
        </where>
    </select>

    <select id="selectOrderById" resultMap="OrderResult">
        select * from order_order where id = #{id}
    </select>

    <insert id="add" parameterType="Order">
        insert into order_order
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="orderSn != null and orderSn != ''"> order_sn,</if>
            <if test="userId != null">user_id,</if>
            <if test="status != null and status != ''"> status,</if>
            <if test="shippingId != null"> shipping_id,</if>
            <if test="actualPrice != null and actualPrice != ''">actual_price,</if>
            <if test="total != null and total != ''">total,</if>
            <if test="actualTotal != null and actualTotal != ''">actual_total,</if>
            <if test="typeId != null">type_id,</if>
            create_time
        </trim>
        values
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="orderSn != null and orderSn != ''">#{orderSn},</if>
            <if test="userId != null">#{userId},</if>
            <if test="status != null and status != ''">#{status},</if>
            <if test="shippingId != null">#{shippingId},</if>
            <if test="actualPrice != null and actualPrice != ''">#{actual_price},</if>
            <if test="total != null and total != ''">#{total},</if>
            <if test="actualTotal != null and actualTotal != ''">#{actualTotal},</if>
            <if test="typeId != null">#{typeId},</if>
            sysdate()
        </trim>
    </insert>

    <update id="edit" parameterType="Order">
        update order_order
        <set>
            <trim suffixOverrides=",">
                <if test="orderSn != null and orderSn != ''">order_sn = #{orderSn},</if>
                <if test="userId != null">user_id  = #{userId},</if>
                <if test="status != null and status != ''">status = #{status},</if>
                <if test="shippingId != null">shipping_id = #{shippingId },</if>
                <if test="shippingName != null">shipping_name = #{shippingName},</if>
                <if test="shippingNo != null">shipping_no = #{shippingNo },</if>
                <if test="actualPrice != null and actualPrice != ''">actual_price = #{actualPrice},</if>
                <if test="total != null and total != ''">total = #{total},</if>
                <if test="actualTotal != null and actualTotal != ''">actual_total = #{actualTotal},</if>
                <if test="typeId != null">type_id = #{typeId},</if>
                create_time = sysdate()
            </trim>
        </set>
        where id = #{id}
    </update>

    <delete id="deleteById">
        delete from order_order where id = #{id}
    </delete>

    <delete id="deleteByIds">
        delete from order_order where id in
        <foreach collection="array" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

</mapper>
